export default function(e){const t=(e=e||{}).lazyClass||"lazy",o=e.lazyBackgroundClass||"lazy-bg",n="idleLoadTimeout"in e?e.idleLoadTimeout:200,r=e.observeChanges||!1,s=e.events||{},i=window,a="requestIdleCallback",l="IntersectionObserver",d=["srcset","src","poster"],c=[],u=(e,n)=>c.slice.call((n||document).querySelectorAll(e||"img."+t+",video."+t+",iframe."+t+",."+o)),b=t=>{const n=t.parentNode;let r,s=[];"PICTURE"==n.nodeName&&(r=n),"VIDEO"==t.nodeName&&(r=t),s=u("source",r);for(let e in s)v(s[e]);v(t),t.autoplay&&t.load();const i=t.classList;i.contains(o)&&(i.remove(o),i.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},g=e=>{for(let t in s)e.addEventListener(t,s[t].listener||s[t],s[t].options||void 0);m.observe(e)},v=e=>{d.forEach(t=>{t in e.dataset&&i.requestAnimationFrame(()=>{e[t]=e.dataset[t]})})};let f=u();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))for(let e in f)b(f[e]);else if(l in i&&l+"Entry"in i&&"isIntersecting"in i[l+"Entry"].prototype){var m=new i[l]((e,o)=>{e.forEach(e=>{if(e.isIntersecting){const s=e.target;a in i&&n?i[a](()=>{b(s)},{timeout:n}):b(s),s.classList.remove(t),o.unobserve(s),(f=f.filter(e=>e!=s)).length||r||m.disconnect()}})},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});for(let e in f)g(f[e]);r&&new MutationObserver(()=>{u().forEach(e=>{f.indexOf(e)<0&&(f.push(e),g(e))})}).observe(u(e.observeRootSelector||"body")[0],e.mutationObserverOptions||{childList:!0,subtree:!0})}}
